server {
    listen 80;
    server_name localhost;

    # API Gateway logs
    access_log /var/log/nginx/api_gateway_access.log;
    error_log /var/log/nginx/api_gateway_error.log;

    # Proxy headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Authentication and Authorization Service
    location /api/auth/ {
        proxy_pass http://auth_service:8001/;
    }

    # User Profile Service
    location /api/profiles/ {
        proxy_pass http://profile_service:8002/profiles/;
    }

    location /api/interests/ {
        proxy_pass http://profile_service:8002/interests/;
    }

    # Content Management Service
    location /api/sources/ {
        proxy_pass http://content_service:8003/sources/;
    }

    location /api/tags/ {
        proxy_pass http://content_service:8003/tags/;
    }

    # Collection Service
    location /api/collections/ {
        proxy_pass http://collection_service:8004/collections/;
    }

    # Parser Service
    location /api/parser/ {
        proxy_pass http://parser_service:8005/parser/;
    }

    # Recommendation Service
    location /api/recommendations/ {
        proxy_pass http://recommendation_service:8006/recommendations/;
    }

    # Search Service
    location /api/search/ {
        proxy_pass http://search_service:8007/search/;
    }

    # Social Service
    location /api/social/ {
        proxy_pass http://social_service:8008/social/;
    }

    # Admin Service
    location /api/admin/ {
        proxy_pass http://admin_service:8009/admin/;
    }

    location /api/moderation/ {
        proxy_pass http://admin_service:8009/moderation/;
    }

    # Health check
    location /health {
        return 200 'API Gateway is running';
        add_header Content-Type text/plain;
    }

    # Default location block for handling 404 errors
    location / {
        return 404 'Not Found';
        add_header Content-Type text/plain;
    }
}